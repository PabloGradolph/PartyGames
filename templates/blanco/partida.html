{% extends "base.html" %}
{% block title %}Partida {{ partida.codigo }}{% endblock %}
{% block content %}
<div class="text-center">
    <h2 class="mb-4">Sala de la partida</h2>
    {% if partida.estado != 'en_juego' %}
        <p class="lead">Código de la partida:</p>
        <div class="display-4 fw-bold mb-3">{{ partida.codigo }}</div>
        <div class="alert alert-info">Comparte este código con tus amigos para que se unan a la partida.</div>
    {% endif %}
    <p class="mb-4">Estado: <span class="badge bg-info">{{ partida.estado }}</span></p>
    {% if mensaje %}
        <div class="alert alert-success">{{ mensaje }}</div>
    {% endif %}
    {% if palabra %}
        <div class="alert alert-primary display-6">Tu palabra secreta: <b>{{ palabra }}</b></div>
    {% endif %}
    <div class="my-4">
        <h4>Jugadores en la sala ({{ jugadores|length }})</h4>
        <ul class="list-group list-group-flush mb-3">
            {% for jugador in jugadores %}
                <li class="list-group-item bg-dark text-light d-flex justify-content-between align-items-center">
                    <span>{{ jugador.username }}{% if partida.host == jugador %} <span class="badge bg-success ms-2">Host</span>{% endif %}</span>
                    {% if es_host and not jugador == user and partida.estado != 'en_juego' %}
                        <form method="post" style="display:inline;">
                            {% csrf_token %}
                            <input type="hidden" name="expulsar" value="{{ jugador.id }}">
                            <button type="submit" class="btn btn-sm btn-danger">Expulsar</button>
                        </form>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
        {% if es_host %}
            <form method="post" class="mb-2">
                {% csrf_token %}
                <button type="submit" name="terminar" value="1" class="btn btn-outline-danger">Terminar partida</button>
            </form>
            {% if partida.estado == 'en_juego' %}
                <form method="post">
                    {% csrf_token %}
                    <button type="submit" name="nuevas_palabras" value="1" class="btn btn-warning">Generar nuevas palabras</button>
                </form>
            {% elif puede_empezar %}
                <form method="post">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-success">Empezar partida</button>
                </form>
            {% else %}
                <div class="alert alert-warning">Se necesitan al menos 4 jugadores para empezar la partida.</div>
            {% endif %}
        {% endif %}
    </div>
</div>
{% endblock %} 